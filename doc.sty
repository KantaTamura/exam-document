\usepackage[jis2004]{otf}
\usepackage{calc, amssymb, url, ifthen, wrapfig, graphicx, tabularx, amsmath, amsthm, physics, efbox, enumitem}
\usepackage{booktabs, multirow}
\usepackage[margin = 16truemm]{geometry}

%% fig file
\graphicspath{{./fig/}}

%% color
\usepackage[x11names]{xcolor}
\definecolor{capblue}{rgb}{0.31, 0.51, 0.74}
\definecolor{capred}{rgb}{0.89, 0.32, 0.20}

%% booktabs
\usepackage[bookmarksnumbered]{hyperref}
\usepackage{pxjahyper}

%% proof
\renewcommand{\proofname}{\textbf{証明}}
\renewcommand{\qedsymbol}{}

%% listings
\usepackage{listings, jlisting}
\renewcommand\lstlistingname{Src.}
\lstset{
	backgroundcolor = {\color[gray]{.99}},
	breaklines      = true,
	breakindent     = 10pt,
	basicstyle      = \ttfamily\scriptsize,
	commentstyle    = {\itshape \color[cmyk]{1,0.4,1,0}},
	classoffset     = 0,
	keywordstyle    = {\bfseries \color[cmyk]{0,1,0,0}},
	stringstyle     = {\ttfamily \color[rgb]{0,0,1}},
	frame           = TBrl,
	framesep        = 5pt,
	numbers         = left,
	stepnumber      = 1,
	numberstyle     = \tiny,
	tabsize         = 4,
	captionpos      = t
}

%% captions format
\usepackage{caption, subcaption}
\captionsetup{format = hang, font = small, labelfont = bf, compatibility = false}
\captionsetup[sub]{subrefformat = parens}
\captionsetup[subfigure]{labelformat=simple}
\renewcommand{\thesubfigure}{(\alph{subfigure})}
\renewcommand{\thefigure}{\thesection.\arabic{figure}}
\renewcommand{\thetable}{\thesection.\arabic{table}}
\renewcommand{\theequation}{\thesection.\arabic{equation}}
\@addtoreset{figure}{section}
\@addtoreset{table}{section}
\@addtoreset{equation}{section}
\AtBeginDocument{
	\renewcommand{\thelstlisting}{\thesection.\arabic{lstlisting}}
	\@addtoreset{lstlisting}{subsection}
}

%% captions option
\usepackage[explicit]{titlesec}
\titleformat{\chapter}{\Large}{}{0pt}{\titleline[l]{\textbf{\thechapter.}\hspace{1zw}#1}\vspace*{3pt}\titlerule}
\titleformat{\section}{\large}{}{0pt}{
	\titleline[l]{\efbox[hidealllines, margin = 4pt, backgroundcolor = black]{\textcolor{white}{\textbf{\thesection}}}\hspace{1zw}#1}
}
\titleformat{\subsection}{\color{capblue}}{}{0pt}{
	\titleline[l]{\efbox[hidealllines, margin = 5pt, backgroundcolor = capblue]{\textcolor{white}{\textbf{\thesubsection}}}\hspace{1zw}#1}\vspace*{0pt}\titlerule
}
\titleformat{\subsubsection}{}{}{0pt}{\titleline[l]{■#1}}
\titlespacing*{\chapter}{0pt}{-10pt}{-10pt}
\titlespacing*{\section}{0pt}{-10pt}{-10pt}
\titlespacing*{\subsection}{0pt}{-10pt}{-10pt}
\titlespacing*{\subsubsection}{0pt}{0pt}{-10pt}
\titleclass{\chapter}{straight}

%% fonts
\usepackage[T1]{fontenc}
\usepackage{newpxtext, newpxmath}
\usepackage[noalphabet, jis2004]{pxchfon}
\setminchofont[0]{UDDigiKyokashoN-R.ttc}
\setgothicfont[0]{UDDigiKyokashoN-B.ttc}

%% tikz
\usepackage{tikz}
\usetikzlibrary{calc}

%% tcolorbox
\usepackage{tcolorbox}
\tcbuselibrary{breakable, raster, skins, xparse}
\newtcbox{\code}[1][]{
	colback=gray!10!white,
	colframe=gray!20!white,
	boxrule=1pt,
	left=0mm,right=0mm,top=0mm,bottom=0mm,
	box align=base,
	nobeforeafter,
	fontupper=\mcfamily
}
\DeclareTColorBox{defbox}{ o m O{1.5} O{} }{
	empty, left=2mm, right=2mm, top=-1mm, attach boxed title to top left={xshift=1.2zw},
	boxed title style={empty,left=-2mm,right=-2mm}, colframe=black, coltitle=black, coltext=black, breakable,
	underlay unbroken={\draw[black,line width=#3pt]
			(title.east) -- (title.east-|frame.east) -- (frame.south east) -- (frame.south west) -- (title.west-|frame.west) -- (title.west); },
	underlay first={\draw[black,line width=#3pt](title.east) -- (title.east-|frame.east) -- (frame.south east) ;
			\draw[black,line width=#3pt] (frame.south west) -- (title.west-|frame.west) -- (title.west); },
	underlay middle={\draw[black,line width=#3pt](frame.north east) -- (frame.south east) ;
			\draw[black,line width=#3pt](frame.south west) -- (frame.north west) ;},
	underlay last={\draw[black,line width=#3pt](frame.north east) -- (frame.south east) -- (frame.south west) -- (frame.north west) ;},
	fonttitle=\gtfamily, IfValueTF={#1}{title=【#2】〈#1〉}{title=【#2】},#4}
\DeclareTColorBox{exprbox}{ o m O{.5} O{} }{
	empty, left=2mm, right=2mm, top=-1mm, attach boxed title to top left={xshift=1.2zw},
	boxed title style={empty,left=-2mm,right=-2mm}, colframe=black, coltitle=black, coltext=black, breakable,
	underlay unbroken={\draw[black,line width=#3pt]
			(title.east) -- (title.east-|frame.east) -- (frame.south east) -- (frame.south west) -- (title.west-|frame.west) -- (title.west); },
	underlay first={\draw[black,line width=#3pt](title.east) -- (title.east-|frame.east) -- (frame.south east) ;
			\draw[black,line width=#3pt] (frame.south west) -- (title.west-|frame.west) -- (title.west); },
	underlay middle={\draw[black,line width=#3pt](frame.north east) -- (frame.south east) ;
			\draw[black,line width=#3pt](frame.south west) -- (frame.north west) ;},
	underlay last={\draw[black,line width=#3pt](frame.north east) -- (frame.south east) -- (frame.south west) -- (frame.north west) ;},
	fonttitle=\gtfamily, IfValueTF={#1}{title=【#2】〈#1〉}{title=【#2】},#4}

%% array stretch
\renewcommand{\arraystretch}{0.9}

%% reference
\newcommand{\fref}[1]{図\ref{#1}}
\newcommand{\tref}[1]{表\ref{#1}}
\newcommand{\eref}[1]{式\ref{#1}}
\newcommand{\sref}[1]{Src. \ref{#1}}

%% itemize and enumerate 
\let\oldenumerate\enumerate
\renewcommand{\enumerate}{
	\oldenumerate
	\setlength{\itemsep}{1pt}
	\setlength{\parskip}{0pt}
	\setlength{\parsep}{0pt}
	\setlength{\itemindent}{-20pt}
}
\let\olditemize\itemize
\renewcommand{\itemize}{
	\olditemize
	\setlength{\itemsep}{1pt}
	\setlength{\parskip}{0pt}
	\setlength{\parsep}{0pt}
	\setlength{\itemindent}{-20pt}
}
\let\olddescription\description
\renewcommand{\description}{
	\olddescription
	\setlength{\itemsep}{1pt}
	\setlength{\parskip}{0pt}
	\setlength{\parsep}{0pt}
	\setlength{\itemindent}{-20pt}
}

%% figure macro
\newcommand{\fig}[4]{
	\begin{figure}[htbp]
		\centering
		\includegraphics[width=#1\linewidth]{#2}
		\caption{#3}
		\label{fig:#4}
	\end{figure}
}